#include <stdio.h>
#include <stdlib.h>

struct nodo {
    int valor;
    struct nodo *esq; //ponteiro esquerdo
    struct nodo *dir; //ponteiro direito
};


typedef struct nodo Nodo;

Nodo* create(int valor) {
    Nodo *n = malloc(sizeof(Nodo));
    n->valor = valor;
    n->esq = NULL;
    n->dir = NULL;
    return n;
}

void imprimir(Nodo *n) {
    if(n==NULL)
        return;
    imprimir(n->esq);
    printf("\n%d", n->valor);
    imprimir(n->dir);
}

void add(Nodo *n, int valor) {
    if(valor < n->valor) {
        if(n->esq == NULL)
            n->esq = create(valor);
        else
            add(n->esq,valor);
    } else {
        if(n->dir == NULL) 
            n->dir = create(valor);
        else
            add(n->dir,valor);
    }
    
}

void rem(Nodo *n, int valor) {
    Nodo *filho = n;
    Nodo *pai;
    do {
        pai = filho;
        if (valor < filho->valor)
            filho = filho->esq;
        else if (valor > filho->valor)
            filho = filho->dir;
    }while(filho!=NULL && filho->valor != valor);
    
    if(filho!=NULL) {
        if(filho->esq == NULL && filho->dir == NULL) { //CASO 1: NODO NAO TEM FILHO
            if(pai->esq == filho) pai->esq = NULL;
            if (pai->dir == filho)pai->dir = NULL;
        }
        
        if(filho->esq != NULL && filho->dir == NULL) { //CASO 2: NODO FILHO TEM UM FILHO A ESQUERDA
            if(pai->esq == filho) pai->esq = filho->esq;
            if(pai->dir == filho) pai->dir = filho->esq;
        }
        
        if(filho->dir != NULL && filho->esq == NULL) { //CASO 2: NODO FILHO TEM UM FILHO A DIREITA
            if(pai->esq == filho) pai->esq = filho->dir;
            if(pai->dir == filho) pai->dir = filho->dir;            
        }
        
        if (filho->esq != NULL && filho->dir != NULL) { //CASO 3: NODO FILHO TEM DOIS FILHOS
            if (filho->esq->dir == NULL) {
                filho->valor = filho->esq->valor;
            }else {
                Nodo *p = filho->esq; //nodo da esquerda
                Nodo *aux = p;
                while(p->dir != NULL) {
                    aux = p;
                    p = p->dir;
                }
                aux->dir = NULL;
                filho->valor = p->valor;
            }
        }
    }
}

int main(void) {
    
    Nodo *raiz = create(5);
    
    add(raiz, 2);
    add(raiz, 1);
    add(raiz, 8);
    add(raiz, 4);
    
    rem(raiz, 4);
    
    imprimir(raiz);

}
